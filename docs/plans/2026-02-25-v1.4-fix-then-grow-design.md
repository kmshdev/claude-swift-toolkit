# v1.4 Design: Fix-Then-Grow

**Date:** 2026-02-25
**Scope:** Depth polish (Phase A-B) + breadth expansion (Phase C)
**Target:** 24 skills, 11 agents, 20 commands (down from 22 — 2 merged)

## Audit Summary (inputs to this design)

- 11 Rich skills, 9 Adequate, 0 stubs
- 10 of 22 commands are stubs (3-5 lines)
- `swift-reviewer` agent: 8 of 14 skill refs point to non-existent skills
- `ios-developer` agent: near-stub (29 lines, no skill refs)
- `code-explorer`/`code-architect`: reference non-standard tools (`KillShell`, `BashOutput`)
- 7 API skills work as lookup tables but lack "when to use" guidance, pitfalls, checklists
- Liquid Glass content duplicated across 4 skills (from prior analysis)
- Missing topics: Networking, App Lifecycle, Performance Profiling, Localization

---

## Phase A — Fix Foundation

### A1. Consolidate Liquid Glass Duplication

**Delete 3 skills/files:**
- `skills/swiftui-liquid-glass-api/` — strict subset of apple-liquid-glass-design
- `skills/swiftui-liquid-glass/` — workflow content absorbed into apple-liquid-glass-design SKILL.md
- `skills/swiftui-components/references/liquid_glass.md` — duplicates apple-liquid-glass-design content

**Absorb unique content into `apple-liquid-glass-design`:**
- Availability/fallback section from `swiftui-expert-skill/references/liquid-glass.md`
- Workflow decision tree from `swiftui-liquid-glass/SKILL.md`
- Review + implementation checklists from `swiftui-liquid-glass/SKILL.md`
- Complete examples (toolbar, card, segmented control) from `swiftui-expert-skill/references/liquid-glass.md`

**Update `swiftui-expert-skill`:**
- Delete `references/liquid-glass.md`
- Replace Liquid Glass section with cross-reference to `apple-liquid-glass-design`

**Update cross-references:**
- `autonomous-ui-workflow/SKILL.md` line 28: `swiftui-liquid-glass-api` → `apple-liquid-glass-design`
- `swiftui-components/references/index.md`: remove liquid_glass entry
- `swiftui-components/SKILL.md`: remove liquid_glass.md from file tree listing

### A2. Fix Broken Agents

**`swift-reviewer` — replace 8 missing skill refs:**

| Remove (missing) | Replace with (exists) |
|---|---|
| `apple-hig-designer` | `macos-app-design` |
| `axiom-sf-symbols-ref` | `swiftui-iconography-api` |
| `ios-glass-ui-designer` | `apple-liquid-glass-design` |
| `swiftui-liquid-glass` | (remove — covered by apple-liquid-glass-design above) |
| `ui-extractor` | (remove — no equivalent needed) |
| `build` | `xcodebuildmcp` |
| `create-view`, `fix-build`, `run-app` | (remove — these are commands, not skills) |
| `neuralforge-*` | (remove — project-specific) |
| `scroll-experience` | (remove — no equivalent) |
| `systematic-debugging` | (remove — no equivalent) |

Final skills list: `apple-liquid-glass-design`, `swiftui-expert-skill`, `swiftui-components`, `macos-app-design`, `macos-development`, `swiftui-iconography-api`, `xcodebuildmcp`, `code-analyzer`

**`ios-developer` — expand from 29 to ~100+ lines:**
- Add skill refs: `ios-testing`, `swiftui-expert-skill`, `swiftui-components`, `swiftui-presentation-api`
- Add workflow: Understand requirement → Check SwiftUI patterns → Implement → Test → Review
- Add SwiftUI/UIKit bridging guidance (UIViewRepresentable, UIViewControllerRepresentable)
- Add iOS-specific concerns: safe area, orientation, size classes, iPad multitasking

**`code-explorer` and `code-architect` — fix non-standard tool names:**
- Replace `KillShell` → remove (not a real tool)
- Replace `BashOutput` → `Bash`

### A3. Merge Overlapping Commands

**Delete `commands/create-view.md`:**
- Content merged into `implement-component.md`
- `implement-component` already has the fuller workflow

**Delete `commands/implement-feature.md`:**
- `feature-dev` is the comprehensive 7-phase orchestration
- `implement-feature` was a thin 6-step duplicate

**Update references:**
- CLAUDE.md: remove `/create-view` from Phase 3, keep `/implement-component`
- README.md: same update

### A4. Expand 6 Stub Commands

**`build.md` (3 lines → ~30 lines):**
- Step 1: Discover project (find .xcodeproj/.xcworkspace, identify schemes)
- Step 2: Load `xcodebuildmcp` or `xcodebuildmcp-cli` skill based on MCP availability
- Step 3: Build with scheme selection (prefer Debug for development)
- Step 4: Parse build output — categorize errors (Swift, linker, SPM, signing)
- Step 5: On success → report. On failure → suggest `/fix-build`
- Reference: `xcodebuildmcp` skill for tool details

**`test.md` (3 lines → ~30 lines):**
- Step 1: Discover test targets (grep for XCTest/Swift Testing imports)
- Step 2: Load `ios-testing` skill for framework patterns
- Step 3: Run tests via `xcodebuildmcp` tool or CLI
- Step 4: Parse results — categorize failures (assertion, timeout, crash, setup)
- Step 5: Report pass/fail with failure details and file:line references
- Reference: `ios-testing` skill

**`fix-build.md` (5 lines → ~30 lines):**
- Step 1: Read build errors from last `/build` or Xcode output
- Step 2: Categorize: SPM resolution → Swift compiler → linker → signing → other
- Step 3: For each category, apply fix strategy:
  - SPM: clean package caches, resolve versions, check platform requirements
  - Swift: check API availability, fix type mismatches, resolve ambiguity
  - Linker: check framework search paths, verify library linking
  - Signing: verify team, provisioning profiles, entitlements
- Step 4: Rebuild and verify fix
- Reference: `xcodebuildmcp-cli` skill for CLI commands

**`run-app.md` (5 lines → ~25 lines):**
- Step 1: Build first (delegate to `/build` workflow)
- Step 2: Select run target — simulator (choose device/OS), physical device, or Mac (for macOS apps)
- Step 3: Launch with optional arguments and environment variables
- Step 4: Monitor console output for runtime errors
- Reference: `xcodebuildmcp` skill

**`refactor-view.md` (5 lines → ~25 lines):**
- Step 1: Read the target view file, measure complexity (line count, nesting depth)
- Step 2: Load `swiftui-view-refactor` skill for ordering rules and MV patterns
- Step 3: Load `swiftui-expert-skill` review checklist — apply performance and composition checks
- Step 4: Apply refactoring: extract subviews, reorder modifiers, simplify state
- Step 5: Verify build still succeeds after refactoring

**`swift-style.md` (3 lines → ~25 lines):**
- Step 1: Check for `swiftlint` / `swift-format` in project (Brewfile, Package.swift, or PATH)
- Step 2: If linter available → run and report violations by severity
- Step 3: If no linter → apply `swiftui-expert-skill` modern API and style checks manually
- Step 4: Auto-fix safe violations (spacing, import ordering, trailing whitespace)
- Step 5: Report remaining manual-fix items with file:line references

### A5. Hookify Utility Subsystem Separation

**CLAUDE.md:**
- Move `/hookify`, `/help`, `/list`, `/configure` out of the main lifecycle section
- Add new "Utility Commands" section at the bottom:
  ```
  ## Utility Commands (Hook Management)
  - `/hookify` — Create a new hook rule
  - `/help` — Hookify documentation
  - `/list` — List active hook rules
  - `/configure` — Configure hookify settings
  ```

**README.md:**
- Same separation: move 4 hookify commands to a "Utilities" subsection under Commands

---

## Phase B — Enrich 7 API Reference Skills

Each skill gets 4 new sections, expanding from ~55-74 lines to ~130-180 lines.

### Standard Additions (all 7 skills)

1. **When to Use Which** — Decision table mapping scenarios to specific API variants
2. **Common Mistakes** — 3-5 pitfalls with before/after code examples
3. **Checklist** — Pre-submission verification items for that domain
4. **Cross-References** — Links to related skills

### Per-Skill Additions

**`swiftui-colors-api` (64 → ~150 lines):**
- Semantic vs hardcoded color decision tree
- Dark mode: `@Environment(\.colorScheme)` pattern, `.preferredColorScheme()`
- Asset catalog colors: `Color("AppPrimary")`, platform bridging `Color(nsColor:)`
- Accessible contrast guidance (WCAG AA minimum 4.5:1)
- Mistakes: hardcoded colors that break in dark mode, using `Color.black` instead of `.primary`

**`swiftui-effects-api` (56 → ~140 lines):**
- Performance cost ranking: blur (expensive at large radii) > shadow > opacity (cheap)
- Canvas vs modifiers decision: Canvas for complex/animated drawing, modifiers for simple effects
- Metal shader patterns: `.colorEffect()`, `.distortionEffect()`, `.layerEffect()` with examples
- Animated effects: blur radius + opacity tied to state with `.animation()`
- Mistakes: blur in ScrollView rows, shadow on every list cell, Canvas without drawingGroup

**`swiftui-iconography-api` (53 → ~140 lines):**
- Weight/scale matching: `.imageScale()` and `.font()` synchronization with adjacent text
- Custom symbols: asset catalog creation, template rendering, multicolor layers
- Button/toolbar rendering: `Label("Title", systemImage:)` pattern, accessibility
- `variableValue` animation example with timer
- Mistakes: mismatched symbol weight with text, missing accessibility labels on icon-only buttons

**`swiftui-input-api` (57 → ~160 lines):**
- `@FocusState` and `@FocusedBinding` patterns for form navigation (Tab key, return key)
- Form validation: inline error display, `.textContentType()` for autofill
- macOS forms: `LabeledContent`, `Form` in `Settings` scene, keyboard shortcuts
- `DatePicker`, `ColorPicker`, `Stepper` coverage
- `onSubmit` with `.submitLabel()` customization
- Mistakes: missing `@FocusState` (no keyboard navigation), `TextField` without `textContentType`

**`swiftui-material-api` (55 → ~140 lines):**
- Material thickness decision: when to use `.ultraThinMaterial` vs `.regularMaterial` vs `.thickMaterial`
- `background(_:in:)` vs `background(_:)`: shape parameter controls clipping
- `containerBackground(_:for:)` for widgets and Live Activities
- `strokeBorder` vs `stroke`: strokeBorder draws inside, stroke straddles the edge
- Mistakes: material without enough content contrast, using `background` instead of `overlay` for badges

**`swiftui-presentation-api` (74 → ~170 lines):**
- `.sheet(item:)` over `.sheet(isPresented:)` — model-based presentation
- `dismiss()` environment action: sheets own their dismissal
- NavigationStack within sheets: separate navigation context
- `.presentationDetents` with `@Binding` for programmatic detent changes
- Error/loading states within presented content
- Mistakes: `.sheet(isPresented:)` with stale data, missing `@Environment(\.dismiss)`, nested sheets

**`swiftui-typography-api` (59 → ~150 lines):**
- Dynamic Type: `minimumScaleFactor`, floor guidance, `@ScaledMetric` for spacing
- `AttributedString` and `Text` markdown: `Text("**bold** and *italic*")`
- `lineLimit`, `truncationMode`, `lineSpacing`, `textSelection(.enabled)`
- HIG style pairing: which system text styles for which UI elements
- Mistakes: hardcoded font sizes (breaks Dynamic Type), `lineLimit(1)` without `truncationMode`

---

## Phase C — 4 New Skills

### C1. `swift-networking` (~150 lines)

**Lifecycle Position:** Phase 3 (Implement). Load when building features that call external APIs.

**Frontmatter description:** "Build, test, or review networking code using URLSession with async/await. Use when adding API calls, implementing authentication, handling errors from remote services, or reviewing network layer code for correctness and resilience."

**Content:**
- Workflow decision tree: REST API client / WebSocket / file download / background transfer
- URLSession async/await: `data(for:)`, `bytes(for:)`, `download(from:)`
- Request building: `URLRequest`, headers, authentication, body encoding
- JSON decoding: `Codable` with `JSONDecoder` configuration, date strategies, `keyDecodingStrategy`
- Error hierarchy: network unavailable → timeout → HTTP 4xx/5xx → decode failure → domain error
- Retry with exponential backoff pattern (3 attempts, 1s/2s/4s)
- `URLSessionConfiguration` presets: `.default` vs `.ephemeral` vs background
- Caching: `URLCache`, `CachePolicy`, ETags
- Checklist: timeouts configured, ATS exceptions documented, errors surfaced to user, cancellation cooperative, no force-unwrap of decoded data
- Reference: `references/networking-patterns.md` — complete protocol-based API client example

### C2. `swift-concurrency` (~180 lines)

**Lifecycle Position:** Phase 3 (Implement) + Phase 5 (Review). Load for async patterns during implementation; use checklist during review.

**Frontmatter description:** "Write, review, or fix Swift concurrency code using actors, async/await, and structured concurrency. Use when implementing concurrent features, resolving data race warnings, migrating from GCD, or enabling Swift 6 strict concurrency mode."

**Content:**
- Decision tree: "Where should this code run?" → MainActor / custom actor / nonisolated / Task
- Actor isolation: `@MainActor` on classes vs methods, global actors, `nonisolated` escape hatch
- Actor reentrancy: why `await` inside actors can interleave, how to guard invariants
- Sendability: `Sendable` conformance, `@unchecked Sendable` (justified cases only), `sending` keyword
- Structured concurrency: `async let`, `TaskGroup`, `ThrowingTaskGroup`, cancellation checking
- Unstructured: `Task { }` vs `Task.detached { }` — when each is appropriate
- Migration patterns: `withCheckedContinuation` / `withCheckedThrowingContinuation` for bridging
- Swift 6 strict mode: common warnings, fixes, `@preconcurrency import`, incremental adoption
- Common patterns: actor-isolated repository, MainActor ViewModel, background processing pipeline
- Checklist: no data races, isolation boundaries documented, cancellation cooperative, `Task` stored for cleanup, `.task` modifier for view lifecycle
- References: `references/actor-patterns.md`, `references/migration-guide.md`

### C3. `swift-app-lifecycle` (~130 lines)

**Lifecycle Position:** Phase 0-1 (Scaffold/Architecture). Load when setting up app entry point, scenes, and system integration.

**Frontmatter description:** "Design and implement the app entry point, scene structure, deep links, and system integrations. Use when scaffolding a new app, adding multi-window support, implementing URL schemes, or configuring push notifications."

**Content:**
- `@main` App protocol structure, `WindowGroup`, `Settings`, `DocumentGroup`, `MenuBarExtra`
- `ScenePhase` lifecycle: `.active` → `.inactive` → `.background` with state preservation
- macOS multi-window: `openWindow(id:)`, `Window` scene, `WindowGroup` with value
- `NSApplicationDelegateAdaptor` / `UIApplicationDelegateAdaptor` for system callbacks
- Deep links: custom URL schemes (Info.plist), Universal Links, `onOpenURL` modifier routing
- Push notifications: `UNUserNotificationCenter`, permission flow, `application(_:didRegisterForRemoteNotificationsWithDeviceToken:)`
- Background tasks: `BGTaskScheduler`, `BGAppRefreshTask`, `BGProcessingTask`
- Checklist: state saved on `.background`, deep link routes complete, notification permissions lazy, background tasks registered in Info.plist
- Reference: `references/scene-patterns.md`

### C4. `swift-localization` (~120 lines)

**Lifecycle Position:** Phase 3 (Implement). Load when adding user-facing text to ensure localization-readiness.

**Frontmatter description:** "Implement localization using modern String Catalogs and LocalizedStringResource. Use when adding user-facing text, handling plurals, formatting numbers/dates for locale, or preparing an app for international release."

**Content:**
- Modern API: `String(localized:)`, `LocalizedStringResource`, `String(localized:defaultValue:comment:)`
- String Catalogs (`.xcstrings`, Xcode 15+): creation, export for translation, automatic extraction
- Legacy `.strings` / `.stringsdict` format for backwards compatibility
- `Text` automatic localization: `Text("key")` vs `Text(verbatim:)`
- Pluralization: `.stringsdict` grammar rules, String Catalog plural variants
- String interpolation in localized strings: `String(localized: "Hello \(name)")`
- Number/date formatting: `Locale`-aware formatters, `Text(value, format:)` pattern
- RTL layout: `layoutDirection` environment, leading/trailing over left/right, `flipsForRightToLeftLayoutDirection`
- Asset catalog localization: per-locale images, colors
- Checklist: no hardcoded user-facing strings, plurals handled, RTL tested, formatters use current locale
- No reference files needed — self-contained

---

## Phase D — Update CLAUDE.md and README.md

After all phases complete:

**CLAUDE.md updates:**
- Add 4 new skills to Phase 3 implement section: `swift-networking`, `swift-concurrency`, `swift-localization`
- Add `swift-app-lifecycle` to Phase 0-1
- Add `swift-concurrency` to Phase 5 (review checklist)
- Remove deleted commands (`/create-view`, `/implement-feature`)
- Add "Utility Commands" section for hookify subsystem
- Update skill taxonomy table: add new categories or merge into existing
- Update skill count (20 → 24)

**README.md updates:**
- Same lifecycle table updates
- Same command list updates
- Update skill-by-phase tables with new skills
- Version bump to 1.4.0

**plugin.json:**
- Version bump to 1.4.0
- Update description to mention concurrency, networking, localization

---

## File Change Summary

| File | Action | Phase |
|---|---|---|
| `skills/swiftui-liquid-glass-api/` | **Delete directory** | A1 |
| `skills/swiftui-liquid-glass/` | **Delete directory** | A1 |
| `skills/swiftui-components/references/liquid_glass.md` | **Delete file** | A1 |
| `skills/swiftui-expert-skill/references/liquid-glass.md` | **Delete file** | A1 |
| `skills/apple-liquid-glass-design/SKILL.md` | Add workflow, checklists, availability section | A1 |
| `skills/apple-liquid-glass-design/references/custom_glass_views.md` | Append complete examples and fallbacks | A1 |
| `skills/autonomous-ui-workflow/SKILL.md` | Fix skill reference | A1 |
| `skills/swiftui-expert-skill/SKILL.md` | Replace liquid glass section with cross-ref | A1 |
| `skills/swiftui-components/SKILL.md` | Fix file tree listing | A1 |
| `skills/swiftui-components/references/index.md` | Remove liquid_glass entry | A1 |
| `agents/swift-reviewer.md` | Replace 8 broken skill refs | A2 |
| `agents/ios-developer.md` | Expand from 29 to ~100+ lines | A2 |
| `agents/code-explorer.md` | Fix non-standard tool names | A2 |
| `agents/code-architect.md` | Fix non-standard tool names | A2 |
| `commands/create-view.md` | **Delete file** | A3 |
| `commands/implement-feature.md` | **Delete file** | A3 |
| `commands/build.md` | Expand 3 → ~30 lines | A4 |
| `commands/test.md` | Expand 3 → ~30 lines | A4 |
| `commands/fix-build.md` | Expand 5 → ~30 lines | A4 |
| `commands/run-app.md` | Expand 5 → ~25 lines | A4 |
| `commands/refactor-view.md` | Expand 5 → ~25 lines | A4 |
| `commands/swift-style.md` | Expand 3 → ~25 lines | A4 |
| `skills/swiftui-colors-api/SKILL.md` | Expand 64 → ~150 lines | B |
| `skills/swiftui-effects-api/SKILL.md` | Expand 56 → ~140 lines | B |
| `skills/swiftui-iconography-api/SKILL.md` | Expand 53 → ~140 lines | B |
| `skills/swiftui-input-api/SKILL.md` | Expand 57 → ~160 lines | B |
| `skills/swiftui-material-api/SKILL.md` | Expand 55 → ~140 lines | B |
| `skills/swiftui-presentation-api/SKILL.md` | Expand 74 → ~170 lines | B |
| `skills/swiftui-typography-api/SKILL.md` | Expand 59 → ~150 lines | B |
| `skills/swift-networking/SKILL.md` | **Create** (~150 lines) | C1 |
| `skills/swift-networking/references/networking-patterns.md` | **Create** | C1 |
| `skills/swift-concurrency/SKILL.md` | **Create** (~180 lines) | C2 |
| `skills/swift-concurrency/references/actor-patterns.md` | **Create** | C2 |
| `skills/swift-concurrency/references/migration-guide.md` | **Create** | C2 |
| `skills/swift-app-lifecycle/SKILL.md` | **Create** (~130 lines) | C3 |
| `skills/swift-app-lifecycle/references/scene-patterns.md` | **Create** | C3 |
| `skills/swift-localization/SKILL.md` | **Create** (~120 lines) | C4 |
| `CLAUDE.md` | Update lifecycle, commands, taxonomy | D |
| `README.md` | Update tables, commands, skill lists | D |
| `plugin.json` | Version 1.4.0 | D |

## Verification

1. `find skills/ -name "*liquid*glass*" -o -name "*glass*liquid*"` → only `apple-liquid-glass-design/`
2. `grep -r "swiftui-liquid-glass" agents/ skills/*/SKILL.md` → zero hits
3. `grep -r "KillShell\|BashOutput" agents/` → zero hits
4. `ls commands/create-view.md commands/implement-feature.md` → both not found
5. All 7 API skills have "Common Mistakes" and "When to Use Which" sections
6. All 4 new skills have lifecycle position, checklist, and frontmatter description
7. `swift-reviewer` skills list contains only skills that exist in `skills/`
8. `wc -l skills/swift-*/SKILL.md` → all > 100 lines
9. `wc -l commands/{build,test,fix-build,run-app,refactor-view,swift-style}.md` → all > 20 lines
10. CLAUDE.md lists 24 skills across all phases
